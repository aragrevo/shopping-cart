{"version":3,"sources":["./src/app/pages/cart/cart-routing.module.ts","./src/app/pages/cart/cart.module.ts","./src/app/pages/cart/cart.component.ts","./src/app/pages/cart/cart.component.html"],"names":[],"mappings":"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","file":"pages-cart-cart-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\nimport { CartComponent } from './cart.component';\r\n\r\nconst routes: Routes = [\r\n  { path: '', component: CartComponent },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class CartRoutingModule { }\r\n","import { FormsModule } from '@angular/forms';\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { RouterModule } from '@angular/router';\r\n\r\nimport { NgZorroAntdModule } from 'src/app/ng-zorro-antd.module';\r\n\r\nimport { CartRoutingModule } from './cart-routing.module';\r\nimport { SharedModule } from './../../theme/shared/shared.module';\r\nimport { CartComponent } from './cart.component';\r\n\r\n\r\n@NgModule({\r\n  declarations: [CartComponent],\r\n  imports: [\r\n    CommonModule,\r\n    RouterModule,\r\n    FormsModule,\r\n    CartRoutingModule,\r\n    NgZorroAntdModule,\r\n    SharedModule\r\n  ]\r\n})\r\nexport class CartModule { }\r\n","import { BreakpointObserver } from '@angular/cdk/layout';\r\nimport { Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { Observable, Subscription } from 'rxjs';\r\n\r\nimport { AuthService } from 'src/app/services/auth.service';\r\nimport { CartService } from 'src/app/services/cart.service';\r\nimport { Cart } from 'src/app/models/cart';\r\nimport { IProductCart } from 'src/app/models/iproduct-cart';\r\nimport { ProductCarts } from 'src/app/models/product-carts';\r\nimport { StatusCart } from 'src/app/models/status-cart.enum';\r\nimport { CartSummary } from 'src/app/theme/shared/components/cart-summary/cart-summary.component';\r\n\r\n@Component({\r\n  selector: 'app-cart',\r\n  templateUrl: './cart.component.html',\r\n  styleUrls: ['./cart.component.scss']\r\n})\r\nexport class CartComponent implements OnInit, OnDestroy {\r\n\r\n  cartSummary!: CartSummary;\r\n  current = 1;\r\n  isSaving = false;\r\n  isSmallScreen = false;\r\n  products$: Observable<IProductCart[]>;\r\n  Subs: Subscription;\r\n  user$: Observable<any | null>;\r\n\r\n\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    public cartService: CartService,\r\n    private breakpointObserver: BreakpointObserver,\r\n  ) {\r\n    this.resetSummary();\r\n    this.user$ = this.authService.hasUser();\r\n    this.products$ = this.cartService.cart$\r\n    this.Subs = this.products$.subscribe(data => this.calculateValues(data));\r\n    this.breakpointObserver.observe([\r\n      '(max-width: 426px)'\r\n    ]).subscribe(result => this.isSmallScreen = result.matches);\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.Subs.unsubscribe();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n  }\r\n\r\n  onChangeQuantity(product: IProductCart) {\r\n    this.cartService.updateProductToCart(product);\r\n  }\r\n\r\n  handleRemoveProduct(productId: number) {\r\n    this.cartService.removeProductToCart(productId)\r\n  }\r\n\r\n  resetSummary() {\r\n    this.cartSummary = { delivery: 0, discount: 0, subtotal: 0, total: 0 };\r\n  }\r\n\r\n  calculateValues(data: IProductCart[]) {\r\n    this.resetSummary();\r\n    const summary = data.reduce((acc, item) => {\r\n      acc.subtotal = acc.subtotal + (item.Quantity * item.Price);\r\n      acc.discount = -acc.subtotal / 10;\r\n      acc.total = acc.subtotal + acc.discount;\r\n      return acc\r\n    }, this.cartSummary);\r\n\r\n    this.cartSummary = { ...summary };\r\n  }\r\n\r\n  async handleFinish() {\r\n    if (this.cartSummary.total == 0) {\r\n      return;\r\n    }\r\n\r\n    this.isSaving = true;\r\n\r\n    if (!this.cartService.cart) {\r\n      this.cartService.cart = {\r\n        id: '-1',\r\n        status: StatusCart.pending\r\n      }\r\n    }\r\n\r\n    try {\r\n      (this.cartService.cart.id == '-1')\r\n        ? await this.newCart()\r\n        : await this.editCart()\r\n\r\n      const products = await this.getProducts(this.cartService.cart.id);\r\n      products.forEach(async product => {\r\n        await this.cartService.saveProductCarts(product)\r\n      });\r\n      await this.cartService.updateCart(this.cartService.cart);\r\n      this.current = 2;\r\n    } catch (error) {\r\n      console.log(error)\r\n    }\r\n    this.isSaving = false;\r\n  }\r\n\r\n  async newCart() {\r\n    const response = await this.cartService.createCart(this.cartService.cart)\r\n    this.cartService.cart.id = response.id;\r\n  }\r\n\r\n  async editCart() {\r\n    const ids = await this.cartService.getProductsOfCart(this.cartService.cart.id)\r\n\r\n    ids.forEach(async id => {\r\n      await this.cartService.deleteProductOfCart(id)\r\n    })\r\n\r\n  }\r\n\r\n  getProducts(cart_id: string): Promise<ProductCarts[]> {\r\n    return new Promise((resolve) => {\r\n      this.products$.subscribe(products => {\r\n        const productCarts = products.map((product) => {\r\n          return {\r\n            product_id: product.id,\r\n            cart_id,\r\n            quantity: product.Quantity\r\n          }\r\n        })\r\n        resolve(productCarts)\r\n      }).unsubscribe()\r\n    })\r\n  }\r\n\r\n  handleBack() {\r\n    this.current = 1;\r\n  }\r\n\r\n  handlePay() {\r\n    this.isSaving = true;\r\n    this.cartService.cart.status = StatusCart.completed;\r\n    this.cartService.updateCart(this.cartService.cart)\r\n      .then(() => {\r\n        this.cartService.clearCart();\r\n        this.current = 3;\r\n      })\r\n      .finally(() => this.isSaving = false)\r\n  }\r\n\r\n}","<nz-page-header nzBackIcon nzTitle=\"Mi Carrito\"></nz-page-header>\r\n<nz-steps [nzCurrent]=\"current\" [nzSize]=\"isSmallScreen ?'small' : 'default'\"\r\n    [nzDirection]=\"isSmallScreen ?'vertical':'horizontal'\">\r\n    <nz-step nzTitle=\"Acceso\" [nzDescription]=\"(user$ | async)?.email\"></nz-step>\r\n    <nz-step nzTitle=\"Confirmar\"></nz-step>\r\n    <nz-step nzTitle=\"Pagar\"></nz-step>\r\n</nz-steps>\r\n<div class=\"steps-content\">\r\n    <div nz-row *ngIf=\"current === 1\">\r\n        <div nz-col nzXs=\"24\" nzSm=\"24\" nzMd=\"24\" nzLg=\"16\" nzXl=\"16\" class=\"ph-1\">\r\n            <app-cart-list [products]=\"(products$ | async)!\" (onChangeQty)=\"onChangeQuantity($event)\"\r\n                (remove)=\"handleRemoveProduct($event)\"></app-cart-list>\r\n        </div>\r\n        <div nz-col nzXs=\"24\" nzSm=\"24\" nzMd=\"24\" nzLg=\"8\" nzXl=\"8\" class=\"ph-1\">\r\n            <app-cart-summary [cartSummary]=\"cartSummary\" [isSaving]=\"isSaving\" (finish)=\"handleFinish()\">\r\n            </app-cart-summary>\r\n        </div>\r\n    </div>\r\n    <div *ngIf=\"current == 2\" class=\"payment\">\r\n        <app-payment [summary]=\"cartSummary\" [isSaving]=\"isSaving\" [cart]=\"cartService.cart\" [user]=\"user$ | async\"\r\n            (onBack)=\"handleBack()\" (onPay)=\"handlePay()\"></app-payment>\r\n    </div>\r\n    <div *ngIf=\"current == 3\" class=\"payment\">\r\n        <nz-card>\r\n            <nz-result nzStatus=\"success\" nzTitle=\"Orden completada!\" nzSubTitle=\"Gracias por tu compra\">\r\n                <div nz-result-extra>\r\n                    <a nz-button [routerLink]=\"['/welcome']\">Continuar</a>\r\n                </div>\r\n            </nz-result>\r\n        </nz-card>\r\n    </div>\r\n</div>"],"sourceRoot":"webpack:///"}