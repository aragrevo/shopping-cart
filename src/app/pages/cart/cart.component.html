<nz-page-header nzBackIcon nzTitle="Mi Carrito"></nz-page-header>
<nz-steps [nzCurrent]="current">
    <nz-step nzTitle="Acceso" [nzDescription]="(user$ | async)?.email"></nz-step>
    <nz-step nzTitle="Confirmar">
    </nz-step>
    <nz-step nzTitle="Pagar"></nz-step>
</nz-steps>
<div class="steps-content">
    <div nz-row *ngIf="current === 1">
        <div nz-col nzFlex="3" class="ph-1">
            <nz-table #nzTable [nzData]="(products$ | async) || []" nzTableLayout="fixed">
                <thead>
                    <tr>
                        <th *ngFor="let column of listOfColumns">
                            {{ column.name }}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let data of nzTable.data">
                        <td> {{ data.nombre }} </td>
                        <td>
                            <nz-statistic [nzValue]="(data.Price | number: '1.0-2')!" [nzPrefix]="'$'"
                                [nzValueStyle]="{ fontSize: '1rem' }">
                            </nz-statistic>
                        </td>
                        <td>
                            <nz-input-number [(ngModel)]="data.Quantity" [nzSize]="'large'" [nzMin]="1" [nzStep]="1"
                                (ngModelChange)="onChangeQuantity(data)"></nz-input-number>
                        </td>
                        <td class="action">
                            <nz-statistic [nzValue]="(data.Quantity * data.Price | number: '1.0-2')!" [nzPrefix]="'$'"
                                [nzValueStyle]="{ fontSize: '1rem' }">
                            </nz-statistic>
                            <button nz-button nzType="default" nzShape="circle"
                                (click)="handleRemoveProduct(data.id)"><i nz-icon nzType="close"></i></button>
                        </td>
                    </tr>
                </tbody>
            </nz-table>
        </div>
        <div nz-col nzFlex="1" class="ph-1">
            <app-cart-summary [cartSummary]="cartSummary" [isSaving]="isSaving" (finish)="handleFinish()">
            </app-cart-summary>
        </div>
    </div>
    <div *ngIf="current == 2" class="payment">
        <nz-card>
            <nz-statistic [nzValue]="(cartSummary.total | number)!" [nzPrefix]="'$'" [nzTitle]="'Total a pagar'"
                [nzValueStyle]="{color: '#47a359'}">
            </nz-statistic>
            <nz-divider></nz-divider>
            <nz-statistic [nzValue]="(user$ | async)?.email" [nzTitle]="'Cliente'"></nz-statistic>
            <nz-statistic [nzValue]="cart?.id" [nzTitle]="'Orden nÃºmero'"></nz-statistic>
            <nz-divider></nz-divider>
            <div nz-row>
                <div nz-col nzSpan="12" style="text-align:left">
                    <a nz-button nzType="link" (click)="handleBack()">Regresar</a>
                </div>
                <div nz-col nzSpan="12">
                    <button nz-button nzType="primary" nzBlock (click)="handlePay()" [nzLoading]="isSaving"
                        [disabled]="isSaving">Pagar</button>
                </div>
            </div>
        </nz-card>
    </div>
    <div *ngIf="current == 3" class="payment">
        <nz-card>
            <nz-result nzStatus="success" nzTitle="Orden completada!" nzSubTitle="Gracias por tu compra">
                <div nz-result-extra>
                    <a nz-button [routerLink]="['/welcome']">Continuar</a>
                </div>
            </nz-result>
        </nz-card>
    </div>
</div>